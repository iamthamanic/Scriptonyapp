{
  "zoomVariables": [
    "zoom (range: 0.0 - 1.0, unitless)",
    "pxPerSec (pixels per second, derived from zoom)",
    "MIN_PX_PER_SEC = 2 (maximum zoom out)",
    "MAX_PX_PER_SEC = 200 (maximum zoom in)"
  ],
  "units": "Pixels per second (px/s). The timeline width is calculated by multiplying the project duration in seconds by pxPerSec. The zoom variable is a normalized 0-1 slider value that is exponentially mapped to pxPerSec for natural zoom feel.",
  "timelineWidthFormula": "timelineWidthPx = totalDurationSec × pxPerSec\n\nWhere:\n  - totalDurationSec = duration in seconds (e.g., 300s = 5min)\n  - pxPerSec = pxPerSecFromZoom(zoom)\n  - pxPerSecFromZoom(zoom) = MIN_PX_PER_SEC × (MAX_PX_PER_SEC / MIN_PX_PER_SEC)^zoom\n  - pxPerSecFromZoom(zoom) = 2 × (200/2)^zoom = 2 × 100^zoom\n\nExample:\n  - duration = 600s (10 min)\n  - zoom = 0.5\n  - pxPerSec = 2 × 100^0.5 = 2 × 10 = 20\n  - timelineWidthPx = 600 × 20 = 12,000px",
  "sliderToScaleFormula": "// Slider range: 0.0 - 1.0\n// Exponential mapping for natural zoom feel:\n\npxPerSec = MIN_PX_PER_SEC × (ratio)^zoom\n\nWhere:\n  - MIN_PX_PER_SEC = 2\n  - MAX_PX_PER_SEC = 200\n  - ratio = MAX_PX_PER_SEC / MIN_PX_PER_SEC = 200/2 = 100\n  - zoom = slider value (0.0 - 1.0)\n\nFormula:\n  pxPerSec = 2 × 100^zoom\n\nExamples:\n  - slider = 0.0  → pxPerSec = 2 × 100^0.0 = 2 × 1 = 2 px/s (maximum zoom out)\n  - slider = 0.5  → pxPerSec = 2 × 100^0.5 = 2 × 10 = 20 px/s (middle)\n  - slider = 1.0  → pxPerSec = 2 × 100^1.0 = 2 × 100 = 200 px/s (maximum zoom in)\n\nInverse (pxPerSec to zoom):\n  zoom = log(pxPerSec / MIN_PX_PER_SEC) / log(ratio)\n  zoom = log(pxPerSec / 2) / log(100)\n  zoom = ln(pxPerSec / 2) / ln(100)",
  "minZoomBehavior": "At minimum zoom (slider = 0.0):\n  - pxPerSec = 2 pixels per second (MIN_PX_PER_SEC)\n  - Visible duration in viewport = viewportWidthPx / 2\n  \nThe visible time span IS DYNAMIC and depends on viewport width:\n  - viewportWidth = 800px → visible = 800/2 = 400s = 6.67 min\n  - viewportWidth = 1920px → visible = 1920/2 = 960s = 16 min\n  \nThe system uses AUTO-FIT on initial load:\n  - Initial pxPerSec = viewportWidth / totalDurationSec\n  - Clamped to range [MIN_PX_PER_SEC, MAX_PX_PER_SEC] = [2, 200]\n  - Entire timeline fits in viewport if possible\n  - If project is too long (> viewportWidth/2 seconds), zooms to minimum\n  \nExample initial zoom:\n  - Project duration = 600s (10 min)\n  - Viewport width = 1200px\n  - Initial pxPerSec = 1200/600 = 2 px/s\n  - Initial zoom = log(2/2) / log(100) = 0.0 (minimum)\n  - Entire 10-minute timeline fits in 1200px viewport",
  "additionalFeatures": {
    "anchoredZoom": "Zoom anchors to cursor position or viewport center. When zooming, the time position under the cursor remains fixed. Formula: newScrollLeft = timeUnderCursor × newPxPerSec - cursorOffsetX",
    "trackpadZoom": "Ctrl+Wheel zooms with cursor-anchored behavior. Zoom delta = -wheelDeltaY × 0.001",
    "dynamicTicks": "Ruler ticks are dynamically calculated to avoid overlap. Minimum spacing = 80px. Tick steps: [1s, 2s, 5s, 10s, 15s, 30s, 1min, 2min, 5min, 10min, 15min, 30min, 1h, 2h, 3h]. Step is chosen so that tickStepSeconds × pxPerSec >= 80px",
    "viewportCulling": "Only renders timeline items visible in current viewport plus margin",
    "smoothPlayhead": "Playhead animates at 60fps via requestAnimationFrame with delta time interpolation, independent of React render rate",
    "bookTimeline": "For book projects, duration is calculated from total words and reading speed (WPM). Default reading speed = 150 WPM. Duration = (totalWords / readingSpeedWpm) × 60 seconds",
    "resizableTracks": "Track heights are dynamically resizable with min/max constraints and localStorage persistence (CapCut-style)"
  },
  "codeReferences": {
    "mainFile": "/components/VideoEditorTimeline.tsx",
    "zoomConstants": "Lines 38-40",
    "zoomFunctions": "Lines 52-62 (pxPerSecFromZoom, zoomFromPxPerSec)",
    "timelineWidthCalculation": "Line 501",
    "sliderHandler": "Lines 634-637",
    "initialAutoFit": "Lines 477-498",
    "anchoredZoomLogic": "Lines 612-632"
  },
  "performanceOptimizations": {
    "rafPlayhead": "Smooth 60fps playhead via RAF, decoupled from React state updates",
    "throttledStateUpdates": "State updates throttled to max 10x/sec to prevent render spam",
    "viewportCulling": "Only renders visible timeline items",
    "exponentialZoom": "Exponential mapping provides natural zoom feel with more precision at lower zoom levels",
    "debouncing": "No debouncing on zoom slider for instant visual feedback (smooth performance via RAF)"
  }
}
